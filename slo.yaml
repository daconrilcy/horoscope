{
  "service": "horoscope-backend",
  "version": 1,
  "owner": "team-astro",
  "conventions": {
    "latency_units": "seconds",
    "error_rate_unit": "ratio",
    "notes": "All latency targets are seconds; error_rate is a ratio (0-1)."
  },
  "defaults": {
    "min_requests_window": {"window": "5m", "min_requests": 100},
    "error_selector": "5xx"
  },
  "slos": [
    {
      "id": "availability",
      "name": "API availability",
      "objective": "Availability of public API endpoints",
      "target": 0.999,
      "window": "30d",
      "alerts": [
        {
          "name": "api_availability_drop",
          "expr": "1 - (sum(rate(http_requests_total{status=~\"5..\"}[5m])) / sum(rate(http_requests_total[5m]))) > 0.001",
          "severity": "critical"
        },
        {
          "name": "burn_rate_fast",
          "expr": "(sum(rate(http_requests_total{status=~\\\"5..\\\"}[5m])) / sum(rate(http_requests_total[5m]))) / 0.001 > 14.4",
          "severity": "warning"
        },
        {
          "name": "burn_rate_slow",
          "expr": "(sum(rate(http_requests_total{status=~\\\"5..\\\"}[6h])) / sum(rate(http_requests_total[6h]))) / 0.001 > 1",
          "severity": "warning"
        }
      ]
    },
    {
      "id": "chat_latency_p95",
      "name": "Chat P95 latency",
      "objective": "P95 latency for /chat/advise",
      "target_seconds": 2.0,
      "window": "30d",
      "alerts": [
        {
          "name": "chat_p95_high",
          "expr": "histogram_quantile(0.95, sum by (le) (rate(chat_latency_seconds_bucket[5m]))) > 2",
          "severity": "warning"
        }
      ]
    },
    {
      "id": "endpoint_chat_answer_latency",
      "name": "GET /chat/answer latency",
      "objective": "Latency P95/P99 for GET /chat/answer",
      "route": "/chat/answer",
      "method": "GET",
      "target_p95_seconds": 0.30,
      "target_p99_seconds": 0.70,
      "window": "30d",
      "min_requests_window": {"window": "5m", "min_requests": 100},
      "alerts": [
        {
          "name": "chat_answer_p95_high",
          "expr": "histogram_quantile(0.95, sum by (le) (rate(http_server_requests_seconds_bucket{route=\"/chat/answer\",method=\"GET\"}[5m]))) > 0.30",
          "severity": "warning"
        },
        {
          "name": "chat_answer_p99_high",
          "expr": "histogram_quantile(0.99, sum by (le) (rate(http_server_requests_seconds_bucket{route=\"/chat/answer\",method=\"GET\"}[5m]))) > 0.70",
          "severity": "warning"
        }
      ]
    },
    {
      "id": "endpoint_chat_answer_errors",
      "name": "GET /chat/answer error rate",
      "objective": "Error rate for GET /chat/answer",
      "route": "/chat/answer",
      "method": "GET",
      "target_error_rate": 0.005,
      "error_selector": "5xx",
      "min_requests_window": {"window": "5m", "min_requests": 100},
      "window": "30d",
      "alerts": [
        {
          "name": "chat_answer_burn_rate_fast",
          "expr": "((sum(rate(http_requests_total{route=\\\"/chat/answer\\\",method=\\\"GET\\\",status=~\\\"5..\\\"}[1h])) / sum(rate(http_requests_total{route=\\\"/chat/answer\\\",method=\\\"GET\\\"}[1h]))) / 0.005 > 14.4) and (sum(rate(http_requests_total{route=\\\"/chat/answer\\\",method=\\\"GET\\\"}[5m])) > 100)",
          "severity": "critical"
        },
        {
          "name": "chat_answer_burn_rate_medium",
          "expr": "((sum(rate(http_requests_total{route=\\\"/chat/answer\\\",method=\\\"GET\\\",status=~\\\"5..\\\"}[6h])) / sum(rate(http_requests_total{route=\\\"/chat/answer\\\",method=\\\"GET\\\"}[6h]))) / 0.005 > 6) and (sum(rate(http_requests_total{route=\\\"/chat/answer\\\",method=\\\"GET\\\"}[5m])) > 100)",
          "severity": "warning"
        },
        {
          "name": "chat_answer_burn_rate_slow",
          "expr": "((sum(rate(http_requests_total{route=\\\"/chat/answer\\\",method=\\\"GET\\\",status=~\\\"5..\\\"}[24h])) / sum(rate(http_requests_total{route=\\\"/chat/answer\\\",method=\\\"GET\\\"}[24h]))) / 0.005 > 1) and (sum(rate(http_requests_total{route=\\\"/chat/answer\\\",method=\\\"GET\\\"}[5m])) > 100)",
          "severity": "warning"
        }
      ]
    },
    {
      "id": "llm_budget",
      "name": "Monthly LLM budget",
      "objective": "Cumulative LLM cost per month <= budget",
      "target_usd": 500.0,
      "window": "30d",
      "alerts": [
        {
          "name": "llm_budget_80pct",
          "expr": "sum(llm_cost_usd_total) > 400",
          "severity": "warning"
        },
        {
          "name": "llm_budget_100pct",
          "expr": "sum(llm_cost_usd_total) > 500",
          "severity": "critical"
        }
      ]
    },
    {
      "id": "rto_rpo",
      "name": "RTO/RPO objectives",
      "objective": "Recovery Time and Point Objectives",
      "window": "30d",
      "rto_minutes": 30,
      "rpo_minutes": 5,
      "alerts": []
    }
  ]
}
